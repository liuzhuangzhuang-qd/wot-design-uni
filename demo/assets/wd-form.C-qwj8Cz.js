import{d as s,X as e,v as a,o,c as r,w as t,x as p,p as n,n as l,y as m,i as c}from"./index-B0wV8KWu.js";import{a6 as i,c as u,d,C as f,r as g,a7 as h,Y as y,V as w,Q as v,b}from"./page-wraper.xrwG2hFo.js";import{u as C}from"./useChildren.D_bqRQP9.js";const k=b(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:i,setup(s,{expose:i}){const{show:b}=u("wd-form-toast"),k=s,{children:j,linkChildren:x}=C(v);let _=e({});function E(s){s?_[s]="":Object.keys(_).forEach((s=>{_[s]=""}))}return x({props:k,errorMessages:_}),a((()=>k.model),(()=>{k.resetOnChange&&E()}),{immediate:!0,deep:!0}),i({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=w(k.rules);return j.forEach((e=>{g(e.prop)&&g(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=s?{[s]:r[s]}:r;for(const p in t){const s=t[p],r=f(k.model,p);if(s&&s.length>0)for(const t of s){if(t.required&&(!g(r)||""===r)){e.push({prop:p,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:p,message:t.message}),a=!1;break}const{validator:s,...n}=t;if(s){const l=s(r,n);h(l)?o.push(l.then((s=>{"string"==typeof s?(e.push({prop:p,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:p,message:t.message}),a=!1)})).catch((s=>{const o=g(s)?y(s)?s:s.message||t.message:t.message;e.push({prop:p,message:o}),a=!1}))):l||(e.push({prop:p,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=s.filter((s=>s.message));e.length&&("toast"===k.errorType?b(e[0].message):"message"===k.errorType&&e.forEach((s=>{_[s.prop]=s.message})))}(e),a&&(s?E(s):E()),{valid:a,errors:e}},reset:function(){E()}}),(s,e)=>{const a=c;return o(),r(a,{class:l(`wd-form ${s.customClass}`),style:m(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===k.errorType?(o(),r(d,{key:0,selector:"wd-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-e5698d15"]]);export{k as _};
