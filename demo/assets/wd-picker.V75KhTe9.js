import{d as e,r as l,q as a,v as s,m as o,S as t,ad as n,o as u,c as i,w as r,e as c,x as d,n as m,y as p,g as v,f,t as g,F as y,p as _,u as h,V as b,i as k,L as w}from"./index-B0wV8KWu.js";import{f as C,i as V,n as S,m as x,O as $,P as F,g as K,V as T,s as I,r as z,U as q,X as A,w as B,l as L,Q as O,D as j,b as D}from"./page-wraper.xrwG2hFo.js";import{f as M,w as W}from"./wd-picker-view.pYwqwNqQ.js";import{u as P}from"./useTranslate.232Synd_.js";const H=D(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...C,customLabelClass:V(""),customValueClass:V(""),customViewClass:V(""),label:String,placeholder:String,disabled:S(!1),readonly:S(!1),loading:S(!1),loadingColor:V("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:S(!1),size:String,labelWidth:String,useDefaultSlot:S(!1),useLabelSlot:S(!1),error:S(!1),alignRight:S(!1),beforeConfirm:Function,closeOnClickModal:S(!0),safeAreaInsetBottom:S(!0),ellipsis:S(!1),columnsHeight:x(217),valueKey:V("value"),labelKey:V("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:x(15),prop:String,rules:$(),immediateChange:S(!1),clearable:S(!1)},emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:C,emit:V}){const{translate:S}=P("picker"),x=e,$=V,D=l(null),H=F(),R=l(!1),U=l(!1),E=l(""),G=l(""),N=l([]),Q=l([]),X=l(!1),J=l(!1),Y=a((()=>x.loading||R.value));s((()=>x.displayFormat),(e=>{e&&!j(e)&&console.error("The type of displayFormat must be Function"),D.value&&0!==D.value.getSelectedIndex().length&&se(x.modelValue)}),{immediate:!0,deep:!0}),s((()=>x.modelValue),(e=>{G.value=e,se(e)}),{deep:!0,immediate:!0}),s((()=>x.columns),(e=>{N.value=T(e),Q.value=T(e),se(x.modelValue)}),{deep:!0,immediate:!0}),s((()=>x.columnChange),(e=>{e&&!j(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:Z}=K(O),ee=a((()=>Z&&x.prop&&Z.errorMessages&&Z.errorMessages[x.prop]?Z.errorMessages[x.prop]:"")),le=a((()=>{let e=!1;if(Z&&Z.props.rules){const l=Z.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===x.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return x.required||x.rules.some((e=>e.required))||e})),{proxy:ae}=w();function se(e){I(e)&&e.length>0||z(e)&&!I(e)&&""!==e?D.value?n((()=>{re(D.value.getSelects())})):re(function(e){const l=M(x.columns,x.valueKey,x.labelKey);if(0===x.columns.length)return;if(""===e||!z(e)||I(e)&&0===e.length)return;const a=q(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=I(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let o=l[a].findIndex((l=>l[x.valueKey].toString()===e.toString()));o=-1===o?0:o,s.push(o)}));const o=s.map(((e,a)=>l[a][e]));if(1===o.length)return o[0];return o}(e)):E.value=""}function oe(){x.disabled||x.readonly||($("open"),U.value=!0,G.value=x.modelValue,N.value=Q.value)}function te(){U.value=!1,$("cancel");let e=setTimeout((()=>{clearTimeout(e),z(D.value)&&D.value.resetColumns(Q.value)}),300)}function ne(){if(Y.value)return;if(X.value)return void(J.value=!0);const{beforeConfirm:e}=x;e&&j(e)?e(G.value,(e=>{e&&ue()}),ae.$.exposed):ue()}function ue(){if(Y.value||x.disabled)return void(U.value=!1);const e=D.value.getSelects(),l=D.value.getValues(),a=D.value.getColumnsData();U.value=!1,Q.value=T(a),$("update:modelValue",l),re(e),$("confirm",{value:l,selectedItems:e})}function ie({value:e}){G.value=e}function re(e){if(I(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=x;E.value=(x.displayFormat||A)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){X.value=!0}function me(){X.value=!1,J.value&&(J.value=!1,ne())}o((()=>{se(x.modelValue)})),t((()=>{N.value=T(x.columns),Q.value=T(x.columns)}));const pe=a((()=>x.clearable&&!x.disabled&&!x.readonly&&E.value.length));function ve(){const e=I(G.value)?[]:"";$("update:modelValue",e),$("clear")}const fe=a((()=>!x.disabled&&!x.readonly&&!pe.value));return C({close:function(){te()},open:function(){oe()},setLoading:function(e){R.value=e}}),(e,l)=>{const a=k;return u(),i(a,{class:m(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${h(H).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:p(e.customStyle)},{default:r((()=>[c(a,{class:"wd-picker__field",onClick:oe},{default:r((()=>[e.useDefaultSlot?d(e.$slots,"default",{key:0},void 0,!0):(u(),i(a,{key:1,class:"wd-picker__cell"},{default:r((()=>[e.label||e.useLabelSlot?(u(),i(a,{key:0,class:m(`wd-picker__label ${e.customLabelClass}  ${le.value?"is-required":""}`),style:p(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:r((()=>[e.label?(u(),v(y,{key:0},[f(g(e.label),1)],64)):d(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):_("",!0),c(a,{class:"wd-picker__body"},{default:r((()=>[c(a,{class:"wd-picker__value-wraper"},{default:r((()=>[c(a,{class:m(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${E.value?"":"wd-picker__placeholder"}`)},{default:r((()=>[f(g(E.value?E.value:e.placeholder||h(S)("placeholder")),1)])),_:1},8,["class"]),fe.value?(u(),i(B,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"})):pe.value?(u(),i(a,{key:1,onClick:b(ve,["stop"])},{default:r((()=>[c(B,{"custom-class":"wd-picker__clear",name:"error-fill"})])),_:1})):_("",!0)])),_:1}),ee.value?(u(),i(a,{key:0,class:"wd-picker__error-message"},{default:r((()=>[f(g(ee.value),1)])),_:1})):_("",!0)])),_:1})])),_:3}))])),_:3}),c(L,{modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wd-picker__popup"},{default:r((()=>[c(a,{class:"wd-picker__wraper"},{default:r((()=>[c(a,{class:"wd-picker__toolbar",onTouchmove:ce},{default:r((()=>[c(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:te},{default:r((()=>[f(g(e.cancelButtonText||h(S)("cancel")),1)])),_:1}),e.title?(u(),i(a,{key:0,class:"wd-picker__title"},{default:r((()=>[f(g(e.title),1)])),_:1})):_("",!0),c(a,{class:m("wd-picker__action "+(Y.value?"is-loading":"")),onClick:ne},{default:r((()=>[f(g(e.confirmButtonText||h(S)("done")),1)])),_:1},8,["class"])])),_:1}),c(W,{ref_key:"pickerViewWd",ref:D,"custom-class":e.customViewClass,modelValue:G.value,"onUpdate:modelValue":l[0]||(l[0]=e=>G.value=e),columns:N.value,loading:Y.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:ie,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-59e8dd09"]]);export{H as _};
