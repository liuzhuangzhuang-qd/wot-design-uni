import{d as e,r as s,X as a,o,c as t,w as l,e as i,p as n,V as r,n as u,y as c,ad as d,ak as p,i as m,N as f,al as v,am as y,q as h,v as _,g as w,F as b,h as g,x as k,f as C,t as x,u as F,aj as T,l as z,j as P,an as L,a1 as D,z as I,J as M}from"./index-B0wV8KWu.js";import{f as S,a0 as K,w as N,b as E,s as U,O as j,i as $,n as A,m as R,D as O,q as V,S as q,a1 as G,U as H,r as X,V as J,a2 as B,a3 as Q}from"./page-wraper.xrwG2hFo.js";import{u as W}from"./useTranslate.232Synd_.js";const Y=E(e({name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...S},setup(e,{expose:f}){const v=s(!1),y=a({url:"",poster:"",title:""});function h(){v.value=!1,d((()=>{y.url="",y.poster="",y.title=""}))}return K((()=>v.value)),f({open:function(e){v.value=!0,y.url=e.url,y.poster=e.poster,y.title=e.title},close:h}),(e,s)=>{const a=p,d=m;return v.value?(o(),t(d,{key:0,class:u(`wd-video-preview ${e.customClass}`),style:c(e.customStyle),onClick:h},{default:l((()=>[i(d,{class:"wd-video-preview__video",onClick:s[0]||(s[0]=r((()=>{}),["stop"]))},{default:l((()=>[y.url?(o(),t(a,{key:0,class:"wd-video-preview__video",controls:!0,poster:y.poster,title:y.title,"play-btn-position":"center",enableNative:!0,src:y.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):n("",!0)])),_:1}),i(N,{name:"close","custom-class":"wd-video-preview__close",onClick:h})])),_:1},8,["class","style"])):n("",!0)}}}),[["__scopeId","data-v-dfc3ea0a"]]);function Z(e){if(U(e.tempFiles)){const s=[];return e.tempFiles.forEach((async e=>{s.push({path:e.path||"",name:e.name||"",size:e.size,type:"image",thumb:e.path||""})})),s}return[{path:e.tempFiles.path||"",name:e.tempFiles.name||"",size:e.tempFiles.size,type:"image",thumb:e.tempFiles.path||""}]}const ee=E(e({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...S,fileList:j(),action:$(""),header:{type:Object,default:()=>({})},multiple:A(!1),disabled:A(!1),limit:Number,showLimitNum:A(!0),maxSize:R(Number.MAX_VALUE),sourceType:{type:Array,default:()=>["album","camera"]},sizeType:{type:Array,default:()=>["original","compressed"]},name:$("file"),formData:{type:Object,default:()=>{}},onPreviewFail:Function,beforeUpload:Function,beforeChoose:Function,beforeRemove:Function,beforePreview:Function,buildFormData:Function,loadingType:$("ring"),loadingColor:$("#ffffff"),accept:$("image"),statusKey:$("status"),loadingSize:$("24px"),compressed:A(!0),maxDuration:R(60),camera:$("back"),imageMode:$("aspectFit"),successStatus:R(200),customEvokeClass:$(""),customPreviewClass:$(""),autoUpload:A(!0),reupload:A(!1),uploadMethod:Function},emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:a,emit:r}){const d=e,S=r;a({submit:()=>se()});const{translate:K}=W("upload"),E=s([]),U=h((()=>!d.limit||E.value.length<d.limit)),j=s();function $(){S("update:fileList",E.value)}_((()=>d.fileList),(e=>{const{statusKey:s}=d;if(q(e,E.value))return;const a=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",{...e,uid:G.id++})));E.value=a}),{deep:!0,immediate:!0}),_((()=>d.limit),(e=>{e&&e<E.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),_((()=>d.beforePreview),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),_((()=>d.onPreviewFail),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),_((()=>d.beforeRemove),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),_((()=>d.beforeUpload),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),_((()=>d.beforeChoose),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),_((()=>d.buildFormData),(e=>{e&&!O(e)&&"asyncfunction"!==H(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0});const A=(e,s,a)=>{const{statusKey:o,uploadMethod:t}=d;e[o]="loading",O(t)?t(e,s,a):((e,s,a)=>{T({url:a.action,header:a.header,name:a.name,fileName:a.name,fileType:a.fileType,formData:s,filePath:e.url,success(o){o.statusCode===a.statusCode?a.onSuccess(o,e,s):a.onError({...o,errMsg:o.errMsg||""},e,s)},fail(o){a.onError(o,e,s)}}).onProgressUpdate((s=>{a.onProgress(s,e)}))})(e,s,a)};function R(e){return new Promise(((s,a)=>{M({src:e,success:e=>{s(e)},fail:e=>{a(e)}})}))}function ee(e,s){const{statusKey:a}=d,o={uid:G.id++,name:e.name||"",thumb:e.thumb||"",[a]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?E.value.splice(s,1,o):E.value.push(o),d.autoUpload&&se()}function se(){const{buildFormData:e,formData:s={},statusKey:a}=d,{action:o,name:t,header:l={},accept:i,successStatus:n}=d,r=X(n)?n:200;for(const u of E.value)"pending"==u[a]&&(e?e({file:u,formData:s,resolve:e=>{e&&A(u,e,{onSuccess:oe,onError:ae,onProgress:te,action:o,header:l,name:t,fileName:t,fileType:i,statusCode:r})}}):A(u,s,{onSuccess:oe,onError:ae,onProgress:te,action:o,header:l,name:t,fileName:t,fileType:i,statusCode:r}))}function ae(e,s,a){const{statusKey:o}=d,t=E.value.findIndex((e=>e.uid===s.uid));t>-1&&(E.value[t][o]="fail",E.value[t].error=e.message,E.value[t].response=e,S("fail",{error:e,file:s,formData:a}),$())}function oe(e,s,a){const{statusKey:o}=d,t=E.value.findIndex((e=>e.uid===s.uid));t>-1&&(E.value[t][o]="success",E.value[t].response=e.data,S("change",{fileList:E.value}),S("success",{file:s,fileList:E.value,formData:a}),$())}function te(e,s){const a=E.value.findIndex((e=>e.uid===s.uid));a>-1&&(E.value[a].percent=e.progress,S("progress",{response:e,file:s}))}function le(e){const{multiple:s,maxSize:a,accept:o,sizeType:t,limit:l,sourceType:i,compressed:n,maxDuration:r,camera:u,beforeUpload:c}=d;(function({multiple:e,sizeType:s,sourceType:a,maxCount:o,accept:t,compressed:l,maxDuration:i,camera:n}){return new Promise(((r,u)=>{switch(t){case"image":f({count:e?Math.min(o,9):1,sizeType:s,sourceType:a,success:e=>r(Z(e)),fail:e=>{u(e)}});break;case"video":y({sourceType:a,compressed:l,maxDuration:i,camera:n,success:e=>{r(function(e){return[{path:e.tempFilePath||e.filePath||"",name:e.name||"",size:e.size,type:"video",thumb:e.thumbTempFilePath||"",duration:e.duration}]}(e))},fail:u});break;case"all":v({count:e?Math.min(o,100):1,type:t,success:e=>r(e.tempFiles),fail:u});break;default:f({count:e?Math.min(o,9):1,sizeType:s,sourceType:a,success:e=>r(Z(e)),fail:u})}}))})({multiple:s,sizeType:t,sourceType:i,maxCount:l?l-E.value.length:9,accept:o,compressed:n,maxDuration:r,camera:u}).then((o=>{let t=o;s||(t=t.slice(0,1));const l=async s=>{for(let o=0;o<s.length;o++){const t=s[o];if("image"===t.type&&!t.size){const e=await R(t.path);t.size=e.width*e.height}Number(t.size)<=a?ee(t,e):S("oversize",{file:t})}};c?c({files:t,fileList:E.value,resolve:e=>{e&&l(t)}}):l(t)})).catch((e=>{S("chooseerror",{error:e})}))}function ie(e){if(d.disabled)return;const{beforeChoose:s}=d;s?s({fileList:E.value,resolve:s=>{s&&le(e)}}):le(e)}function ne(e){E.value.splice(E.value.findIndex((s=>s.uid===e.uid)),1),S("change",{fileList:E.value}),S("remove",{file:e}),$()}function re(e){L({filePath:e.url,showMenu:!0})}function ue(e,s){const{onPreviewFail:a}=d;D({urls:s,current:s[e],fail(){a?a({index:e,imgList:s}):I({title:"预览图片失败",icon:"none"})}})}function ce(e,s){var a;null==(a=j.value)||a.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function de(e){const{beforePreview:s,reupload:a}=d,o=J(E.value),t=o.findIndex((s=>s.url===e.url)),l=o.filter((e=>pe(e))),i=l.findIndex((s=>s.url===e.url));a?ie(t):s?s({file:e,index:t,imgList:[],fileList:o,resolve:e=>{e&&ce(i,l)}}):ce(i,l)}function pe(e){return e.name&&B(e.name)||B(e.url)}function me(e){return e.name&&Q(e.name)||Q(e.url)}return(e,s)=>{const a=z,r=m,f=p,v=P;return o(),w(b,null,[i(r,{class:u(["wd-upload",e.customClass]),style:c(e.customStyle)},{default:l((()=>[(o(!0),w(b,null,g(E.value,((s,c)=>(o(),t(r,{class:u(["wd-upload__preview",e.customPreviewClass]),key:c},{default:l((()=>[i(r,{class:"wd-upload__status-content"},{default:l((()=>[me(s)?(o(),t(a,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:a}=d,o=J(E.value),t=o.findIndex((s=>s.url===e.url)),l=o.filter((e=>me(e))).map((e=>e.url)),i=l.findIndex((s=>s===e.url));a?ie(t):s?s({file:e,index:t,fileList:o,imgList:l,resolve:e=>{e&&ue(i,l)}}):ue(i,l)}(s)},null,8,["src","mode","onClick"])):pe(s)?(o(),w(b,{key:1},[s.thumb?(o(),t(r,{key:0,class:"wd-upload__video",onClick:e=>de(s)},{default:l((()=>[i(a,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),i(N,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(o(),t(r,{key:1,class:"wd-upload__video",onClick:e=>de(s)},{default:l((()=>[i(f,{src:s.url,title:s.name||"视频"+c,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),i(N,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(o(),t(r,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:a}=d,o=J(E.value),t=o.findIndex((s=>s.url===e.url));a?ie(t):s?s({file:e,index:t,imgList:[],fileList:o,resolve:s=>{s&&re(e)}}):re(e)}(s)},{default:l((()=>[i(N,{name:"file","custom-class":"wd-upload__file-icon"}),i(r,{class:"wd-upload__file-name"},{default:l((()=>[C(x(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[d.statusKey]?(o(),t(r,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:l((()=>["loading"===s[d.statusKey]?(o(),t(r,{key:0,class:"wd-upload__status-content"},{default:l((()=>[i(V,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),i(v,{class:"wd-upload__progress-txt"},{default:l((()=>[C(x(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):n("",!0),"fail"===s[d.statusKey]?(o(),t(r,{key:1,class:"wd-upload__status-content"},{default:l((()=>[i(N,{name:"close-outline","custom-class":"wd-upload__icon"}),i(v,{class:"wd-upload__progress-txt"},{default:l((()=>[C(x(s.error||F(K)("error")),1)])),_:2},1024)])),_:2},1024)):n("",!0)])),_:2},1024)):n("",!0),"loading"===s[d.statusKey]||e.disabled?n("",!0):(o(),t(N,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=d,a=e,o=E.value[a];s?s({file:o,index:a,fileList:E.value,resolve:e=>{e&&ne(o)}}):ne(o)}(c)},null,8,["onClick"])),e.$slots["preview-cover"]?k(e.$slots,"preview-cover",{key:2,file:s,index:c},void 0,!0):n("",!0)])),_:2},1032,["class"])))),128)),U.value?(o(),w(b,{key:0},[e.$slots.default?(o(),t(r,{key:0,class:u(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:ie},{default:l((()=>[k(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(o(),t(r,{key:1,onClick:ie,class:u(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:l((()=>[i(N,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(o(),t(r,{key:0,class:"wd-upload__evoke-num"},{default:l((()=>[C("（"+x(E.value.length)+"/"+x(e.limit)+"）",1)])),_:1})):n("",!0)])),_:1},8,["class"]))],64)):n("",!0)])),_:3},8,["class","style"]),i(Y,{ref_key:"videoPreview",ref:j},null,512)],64)}}}),[["__scopeId","data-v-ce992059"]]);export{ee as _};
